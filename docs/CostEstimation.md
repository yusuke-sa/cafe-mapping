# コスト試算: カフェ・レストラン可視化アプリ (小規模限定公開版)

## 1. 試算前提
- **ユーザー規模**: 開発者本人 + 周囲の5名を最大利用者とし、月間アクティブユーザー(MAU) 6人、ピーク日次アクティブ(DAU) 3人程度。
- **利用頻度**: 1人あたり週2回・1セッション平均5検索 → 月間検索リクエスト約240件。マップ読み込みは月間約500回、店舗詳細表示200回を想定。
- **データ収集量**: 週次でSNS投稿を約200件取り込み（1投稿あたり1,000トークン相当）。AI要約は週1回バッチ実行。
- **AI処理**: `gpt-4o-mini`クラスを利用。月間トークン量は入力80万 / 出力20万トークン（合計100万トークン）を上限目安に設定。
- **リージョン**: Azure東日本リージョン、Google Mapsは東京リージョン発行のAPIキー。
- **為替**: 1 USD = 150 JPY (参考換算)。料金は公式価格を基に概算。
- **備考**: 無料枠・クレジットの活用を前提。料金体系は変更される可能性があるため、実装前に最新情報で再確認が必要。

## 2. サービス別月額試算

| 区分 | サービス / SKU | 主な利用内容 | 想定利用量 | 想定単価 (USD) | 月額 (USD) | 月額 (JPY) |
| --- | --- | --- | --- | --- | --- | --- |
| フロント | Azure Static Web Apps Free | SPAホスティング（プレビュー用途） | 1アプリ、月100GBまで無料 | Free | $0.00 | ¥0 |
| API | Azure Functions (従量) | 月3,000実行・総300MB-s（無料枠内） | 無料枠: 100万実行 & 400k GB-s | Free | $0.00 | ¥0 |
| データベース | Azure Cosmos DB for NoSQL (Serverless) | 月間30万RU消費、データ5GB | 約$0.0098/万RU + Storage | ~$3.00 | $3.00 | 約¥450 |
| 検索 | Azure Cognitive Search Free | 3インデックス以内、50MB以下 | 無料枠内 | Free | $0.00 | ¥0 |
| AI推論 | Azure OpenAI (`gpt-4o-mini`) | 入力80万トークン・出力20万トークン/月 | 入力$0.00015/1K、出力$0.00060/1K | ~$0.30 | $0.30 | 約¥45 |
| ETL | Azure Functions (タイマー起動) | 週1バッチ、無料枠内 | Functionsに含む | - | - | - |
| ストレージ | Azure Storage (Hot Blob) | ローデータ・キャッシュ計10GB | $0.0184/GB | ~$0.18 | $0.18 | 約¥27 |
| 監視 | Azure Monitor / Application Insights | ログ取り込み1GB/月、保持30日 | $2.76/GB 取り込み | ~$2.76 | $2.76 | 約¥414 |
| CI/CD | GitHub Actions Free | 月20回未満のビルド | 無料枠内 | Free | $0.00 | ¥0 |
| 地図 | Google Maps JavaScript API | 500ロード/月 | $7/1,000ロード | $3.50 | $3.50 | 約¥525 |
| 地図 | Google Places Details API | 200コール/月 | $17/1,000コール | $3.40 | $3.40 | 約¥510 |
| 地図 | Google Places Autocomplete API | 200コール/月 | $2.83/1,000コール | $0.57 | $0.57 | 約¥86 |
| 小計 (Google Maps) | Google Maps Platform合計 | 月額$7.47 - 無料クレジット$200 | - | - | **$0.00*** | ¥0 |
| **合計** |  |  |  |  | **$6.24/月** | **約¥936/月** |

> ***Google Maps Platform*** は毎月$200分の無料クレジットが自動付与されるため、上記利用量なら実質無料。ただし請求アカウント登録は必須。

## 3. コスト感のポイント
- **Azureコストはほぼ無料枠内**: Functions・Static Web Apps・Cognitive Search (Free) を利用すれば、Cosmos DBとMonitor以外は$1未満。Cosmos DBはサーバーレス利用量に応じて課金されるため、読み書きが少ない環境では数ドルに抑えられる。
- **AI推論コストはごく小さい**: 週次バッチで当月合計100万トークン程度なら$0.30前後。大きな分析を実施する場合のみコストが増える。
- **Google Mapsは無料クレジット内**: 月間1,000ロード未満ならクレジットで相殺できる。将来ユーザーが増加した場合のみ課金対象となる。
- **監視コストが相対的に目立つ**: Application Insightsのログ取り込みが$2〜3で、全体に占める割合が高い。不要なログはサンプリングで抑制する。

## 4. スケールアップ時の目安
- **利用者が30人規模まで拡大**: 検索リクエストが5倍になった場合でも、Cosmos DBとMonitorが$10程度に収まる見込み。Google Maps呼び出しが5倍でも無料クレジット内。
- **公開範囲を広げる場合**: Cognitive SearchはBasicプラン($81/月)へのアップグレード、Cosmos DBはプロビジョンドスループット、OpenAIトークン量、Google Mapsの従量課金が発生し、月額$100超に跳ね上がる可能性がある。

## 5. コスト最適化・運用メモ
- Cosmos DB ServerlessでRU消費をモニタリングし、不要なクエリを削減する。さらにコストを抑えるなら、Azure Table Storage + Cognitive Searchを検討。
- Application Insightsはサンプリング率やログ保持期間を調整し、取り込み量を1GB未満に維持。
- AI要約は差分更新方式で再処理を最小限にし、モデル試験が必要な場合はAzure OpenAIのクォータを事前確認する。
- Google MapsのPlaces APIは`fields`パラメータで必要情報だけ取得し、結果をキャッシュしてAPIコールを抑制。
- 小規模利用でも請求アカウントとアラートを設定し、無料枠を超えた場合に即時検知できるようにする。

## 6. 次のアクション
1. Azure Cost ManagementでCosmos DB/Monitorのアラート閾値を設定し、無料枠超過を検知。
2. Google CloudコンソールでMapsのクォータアラートを作成し、ロード数・Placesコールの増加を監視。
3. 利用状況に応じてCognitive Search Freeプランの制約（インデックス数・サイズ）を確認し、必要なら早期にBasicプランへの増強を検討。
