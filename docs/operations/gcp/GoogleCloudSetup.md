# Google Cloud プロジェクト & 請求アカウント設定手順

## 1. 目的と前提

- Google Maps Platform（Maps JavaScript API / Places API）を利用するため、Google Cloud プロジェクトと請求アカウントの紐付けが必須。
- ここでは個人利用を想定し、Google アカウントでの設定手順を記載。法人利用の場合も大枠は同じ。
- クレジットカード等の支払い方法を用意し、Google Cloud の利用規約に同意できること。

## 2. Google Cloud プロジェクト作成

1. ブラウザで <https://console.cloud.google.com/> にアクセスし、Google アカウントでサインイン。
2. ヘッダのプロジェクト選択ドロップダウンから **「新しいプロジェクト」** をクリック。
3. プロジェクト名（例：`iijan-map`）を入力し、組織を指定（個人の場合は「組織なし」）。
4. 場合によっては請求アカウント選択を求められるが、未作成なら後で紐づける。
5. **「作成」** を押して完了。通知ベルに「プロジェクトが作成されました」と表示されたら成功。

## 3. 請求アカウントの作成

1. ナビゲーションメニューから **「お支払い」** → **「請求先アカウントの管理」** を開く。
2. **「請求先アカウントを作成」** をクリックし、アカウント名、国（日本）、通貨（JPY）を選択。
3. 利用規約に同意し、請求先情報（住所、連絡先）を入力。
4. クレジットカード情報を登録し、必要に応じて 3D セキュア認証を完了。
5. 作成後、請求アカウントのステータスが「アクティブ」になっていることを確認。

## 4. プロジェクトと請求アカウントの紐付け

1. 作成したプロジェクトで **「お支払い」** メニューを開き、**「お支払いアカウントを設定」** を選択。
2. 新しく作成した請求アカウントを選び、**「リンク」** をクリック。
3. 「このプロジェクトは請求先アカウントとリンクされています」の表示を確認。

## 5. Google Maps Platform API の有効化

1. ナビゲーションメニューから **「API とサービス」→「ライブラリ」** を開く。
2. 利用する API を検索し、**「有効にする」** をクリック。
   - Maps JavaScript API
   - Places API（Details / Autocomplete を含む）
   - Geolocation API（必要な場合）
3. **「認証情報」** メニューで API キーを作成し、以下の制限を設定。
   - **アプリケーション制限**: HTTP リファラー（`https://yourdomain/*` や `http://localhost/*` など）
   - **API 制限**: 利用する API のみに限定
4. API キーはソースコードに直書きせず、環境変数やシークレットマネージャで管理する。

## 6. 請求と予算アラート

- Google Cloud Console の **「お支払い」→「予算とアラート」** で予算を設定する。
  - 例: 月額 1,000 円の予算を設定し、50%、80%、100% でメール通知。
  - 無料クレジット（$200/月）があるが、閾値は USD 換算になるため注意。
- 利用料金レポートを定期的に確認し、API 呼び出しの増加がないか監視する。

## 7. セキュリティと運用のヒント

- API キーはリークしやすいため、GitHub などで公開リポジトリに含めない。誤って公開した場合は速やかにキーをローテーション。
- 本番・開発でプロジェクトを分ける場合は、それぞれに請求アカウントをリンクするか、ラベル・フォルダ構造でコストを分離管理。
- Google Cloud CLI (`gcloud`) を利用する場合は、`gcloud auth login` で認証し、`gcloud config set project <project-id>` でプロジェクト切り替えを行う。
- チーム共有時は Identity and Access Management (IAM) でロールを付与し、オーナー権限の乱用を避ける。
- 請求アカウントの停止やカード有効期限切れがあると API キーも無効化されるため、メール通知設定を有効にして早期に検知する。

## 8. 次のアクション

1. Google Cloud Console でプロジェクトを作成し、請求アカウントとリンク。
2. Maps / Places API のキーを発行し、HTTP リファラ制限を設定。
3. 予算アラート設定と利用状況の定期チェック体制を整える。
